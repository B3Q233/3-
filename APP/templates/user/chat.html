<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chat UI with Layui</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui-src/dist/css/layui.css" media="all">
</head>
<style>
     body {
            display: flex;
            width: auto;
            min-width: 90%;
            align-items: center; /* 垂直居中 */
            min-height: 100vh; /* 确保页面高度至少占满视口高度 */
        }
</style>
<body>

<div class="layui-container" >
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">Chat Room</div>
                <div class="layui-card-body" style="height: 300px; overflow-y: auto;">
                    <!-- 聊天内容展示区域 -->
                    <div id="chat-messages"></div>
                </div>
                <div class="layui-card-footer">
                    <form class="layui-form" action="" onsubmit="return false;">
                        <div class="layui-form-item">
                            <div class="layui-input-inline" style="width: 80%;">
                                <input type="text" name="message" required lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-input-inline" style="width: 15%;">
                                <button class="layui-btn" lay-submit lay-filter="sendMessage">Send</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/layui-src/dist/layui.all.js"></script>
<script>
     // 显示消息函数
    function displayMessage(username, message) {
        let chatMessages = document.getElementById('chat-messages');
        let newMessage = document.createElement('div');
        newMessage.innerHTML = `<strong>${username}:</strong>${message}`;
        chatMessages.appendChild(newMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
</script>
<script>
    function sendMsg(msg){
         layui.use(['jquery', 'layer'], function() {
             let $ = layui.jquery;
             let layer = layui.layer;
             console.log(msg)
             // 发送AJAX请求
             $.ajax({
                 url: '/getMsg',
                 type: 'POST',
                 contentType: 'application/json',
                 data: msg,
                 success: function (response) {
                     displayMessage('gpt',response)
                 },
                 error: function (xhr, status, error) {
                     console.error('AJAX请求失败:', error);
                 }
             });
         });
    }
</script>
<script>
    function hideScrollbar() {
        const chatMessages = document.getElementById('chat-messages');
        chatMessages.style.overflowY = 'hidden';
    }
    // 可以在合适的地方调用这个函数，比如页面加载完成后调用
    window.onload = function () {
        hideScrollbar();
    };

layui.use(['form'], function(){
    let form = layui.form;

    // 监听发送消息按钮
    form.on('submit(sendMessage)', function(data){
        let message = data.field.message;
        sendMsg(message)
        // 显示消息
        displayMessage('You', message);
        // 清空输入框
        data.field.message = '';
        return false;
    });
});
</script>

</body>
</html>
